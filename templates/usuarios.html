{% extends "base.html" %}

{% block content %}
<h3 class="mb-3">Usuarios</h3>

<a href="{{ url_for('nuevo_usuario') }}" class="btn btn-success mb-3">
    Nuevo Usuario
</a>

<table class="table table-striped table-bordered align-middle">
    <thead class="table-dark">
        <tr>
            <th>Username</th>
            <th>Rol</th>
            <th>Estado</th>
            <th style="width: 260px;">Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for u in usuarios %}
        <tr>
            <td>{{ u.username }}</td>

            <!-- ROL -->
            <td>
                {% if u.es_admin %}
                    <span class="badge bg-warning text-dark">Admin</span>
                {% else %}
                    <span class="badge bg-secondary">Usuario</span>
                {% endif %}
            </td>

            <!-- ESTADO -->
            <td>
                {% if u.activo %}
                    <span class="badge bg-success">Activo</span>
                {% else %}
                    <span class="badge bg-danger">Inactivo</span>
                {% endif %}
            </td>

            <!-- ACCIONES -->
            <td>
                {% if u.id != current_user.id %}
                <div class="d-flex gap-1">

                    <!-- Activar / Desactivar -->
                    <form method="post"
                          action="{{ url_for('toggle_usuario', user_id=u.id) }}">
                        <button class="btn btn-sm {{ 'btn-danger' if u.activo else 'btn-success' }}">
                            {{ 'Desactivar' if u.activo else 'Activar' }}
                        </button>
                    </form>

                    <!-- Admin / No Admin -->
                    <form method="post"
                          action="{{ url_for('toggle_admin', user_id=u.id) }}">
                        <button class="btn btn-sm btn-warning">
                            {{ 'Quitar admin' if u.es_admin else 'Hacer admin' }}
                        </button>
                    </form>

                </div>
                {% else %}
                    <span class="text-muted fst-italic">Vos</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
